# 《默示录-Link》项目设计与开发总览 v1.0

| **文档版本** | **v1.0**                                                                        |
| :------- | :------------------------------------------------------------------------------ |
| **创建日期** | 2025年8月4日                                                                       |
| **文档目的** | 本文档旨在作为项目的核心“圣经”，全面、精确地阐述游戏的设计理念、已实现的功能模块、核心数值系统以及技术架构。它将作为未来开发、迭代和维护的唯一真实参考依据。 |
| **目标读者** | 游戏策划、数值策划、开发人员、运营及项目管理人员。                                                       |

### **第一部分：游戏设计总览 (Game Design Overview)**

#### **1.1 核心概念 (Core Concept)**

《默示录-Link》是一款基于网页的、以文字和UI交互为核心的MUD（多人在线地下城）角色扮演游戏。游戏的核心玩法聚焦于**战斗、放置成长和生产制造**，旨在为玩家提供一个既有深度策略又不乏轻松休闲的在线体验。

#### **1.2 核心循环 (Core Loop)**

游戏的核心玩法循环被设计为一个正向反馈闭环：

1.  **探索与战斗**: 玩家选择一个区域进行探索，自动遭遇怪物并进入**自动回合制战斗**。
2.  **获取回报**: 战斗胜利后，玩家获得经验值、道具、装备等奖励。
3.  **角色成长**: 玩家利用获得的回报来提升职业等级、武器熟练度，或更换更强的装备。
4.  **挑战更高**: 成长后的角色将有能力挑战更高级的区域，从而获得更好的回报，形成一个持续的成长循环。

#### **1.3 关键特性 (Key Features)**

*   **账户系统**: 玩家可以通过注册和登录，在任何设备上访问自己的专属游戏存档。
*   **多职业系统**: 游戏包含**战斗**和**生产**两大类型的职业，玩家可以在游戏中**随时切换**，每个职业都有其独立的等级和成长体系。
*   **深度属性系统**: 一套包含一级、二级、三级属性的复杂数值体系，拥有精细的**边际收益递减**机制，为角色构筑（Build）提供深度策略空间。
*   **行动条战斗**: 战斗采用基于“速度”属性的**行动条**机制，决定了战斗单位的出手频率，而非传统的回合制。
*   **装备与道具系统**: 丰富的装备部位和多样的道具为战斗和成长提供支持。（待开发）
*   **生产与制造系统**: 玩家可以通过生产职业，采集资源并制造独特的装备和消耗品。（待开发）

### **第二部分：已实现功能模块 (Implemented Feature Modules)**

截至当前版本，我们已经完成了游戏核心框架的搭建。

#### **2.1 用户认证模块**

*   **技术栈**: Firebase Authentication
*   **功能**:

    *   **用户注册**: 支持通过邮箱和密码创建新账户。
    *   **用户登录/登出**: 提供安全的登录和退出功能。
    *   **会话保持**: 用户关闭浏览器后，在一定时间内可以免密自动登录。

#### **2.2 角色管理模块**

*   **技术栈**: Firebase Firestore
*   **功能**:

    *   **角色创建**: 新用户登录后，引导玩家输入昵称（系统会自动为其附加一个如 `#1234` 的唯一标签）、选择性别和初始职业。
    *   **角色数据存储**: 将包含所有一级属性、职业等级等信息的完整角色数据，安全地存储在云端数据库中。
    *   **角色加载**: 玩家登录后，系统会自动检测并加载其角色数据，或引导至角色创建界面。
    *   **角色删除**: 在游戏主界面提供一个测试用的“删除角色”功能，并有二次确认弹窗，方便反复测试。

#### **2.3 核心战斗循环**

*   **技术栈**: JavaScript `setInterval`
*   **功能**:

    *   **探索触发**: 在主界面点击“探索”按钮后，系统会模拟探索过程并触发战斗。
    *   **行动条机制**: 战斗开始后，一个全局的“游戏心跳”（每100毫秒一次）会根据战斗单位的“最终速度”为其增加行动条。
    *   **自动攻击**: 任何单位的行动条达到100后，会自动执行一次普通攻击，然后行动条清零。
    *   **实时日志**: 战斗中的所有事件（攻击、伤害、闪避、暴击等）都会实时显示在战斗日志窗口中。
    *   **战斗结算**: 当一方生命值归零，战斗结束，显示胜利/失败信息，并在短暂延迟后自动返回主游戏界面。

#### **2.4 数值测试工具**

*   **功能**:

    *   **入口**: 在游戏主界面的右上角提供“数值测试”按钮。
    *   **随机模拟**: 点击后会弹出一个覆盖全屏的模态框，随机生成“攻击方”和“防御方”的完整一级属性（包含随机的增益/异常）。
    *   **过程透明**: 工具会清晰地展示双方由一级属性计算出的所有二级属性，并一步步列出本次模拟攻击的**完整计算过程**（命中判定、暴击判定、减伤计算等）。
    *   **便捷调试**: 所有数值名称均为**中文**，百分比数值会格式化为`xx.xx%`，方便策划人员进行调试和验证。提供“重新生成”按钮以进行多次测试。

### **第三部分：核心系统详解：人物属性与战斗公式**

这是游戏数值体系的核心，所有计算都严格遵循此文档。

#### **3.1 边际收益递减机制**

本系统采用**分段线性函数**来实现边际收益。可以将其理解为“个人所得税”的计算方式：角色的基础属性值落在不同的“税级”（阈值）中，每个“税级”的“税率”（收益率）都不同。

**通用函数 f(x) 定义**: `f(x) = 初始值 + 段落1收益 + 段落2收益 + ...`

*   **段落1收益**: `MIN(x, T1) * R1`
*   **段落2收益**: `MAX(0, MIN(x - T1, T2 - T1)) * R2`
*   ...以此类推。 最终，`最终结果 = MIN(f(x), 上限)`。

#### **3.2 二级属性计算公式**

*   **最终攻击力**: `基础攻击力 * 攻击性能 * (1 + 攻击加成)`
*   **物理伤害减免%**: `f((基础防御力 * 防御性能) + (基础抗性 * 0.05))`
*   **魔源伤害减免%**: `f((基础魔防力 * 防御性能) + (基础抗性 * 0.05))`
*   **最终命中率%**: `f(基础命中)`
*   **最终闪避率%**: `f(基础闪避)`
*   **最终暴击率%**: `f(基础暴击)`
*   **最终暴击伤害%**: `f(基础暴击)`
*   **最终抗暴率%**: `f(基础耐性 + (基础抗性 * 0.1))`
*   **最终暴伤抵抗%**: `f(基础耐性 + (基础抗性 * 0.1))`
*   **异常相关(增益)%**: `f(基础精通)`
*   **异常相关(抵抗)%**: `f(基础抗性 + (基础神圣力 * 0.05))`
*   **增益/治疗效果%**: `f(基础精通 + (基础神圣力 * 0.05))`
*   **格挡几率/效果%**: `f(格挡能力)`
*   **穿透率%**: `f(穿透力)`
*   **伤害稳定%**: `f(基础命中 + (基础精通 * 0.2))`

#### **3.3 最终战斗判定公式**

*   **实际命中率%** = `clamp(攻击方.最终命中率% - 防御方.最终闪避率%, 60%, 98%)`
*   **实际暴击率%** = `clamp(攻击方.最终暴击率% - 防御方.最终抗暴率%, 1%, 80%)`
*   **实际暴击伤害%** = `clamp(攻击方.最终暴击伤害% - 防御方.最终暴伤抵抗%, 120%, 200%)`
*   **实际伤害减免%** = `clamp(防御方.伤害减免% * (1 - 攻击方.穿透率%), 30%, 95%)`

#### **3.4 最终伤害计算流程**

1.  **判定命中**
2.  **计算基础伤害**
3.  **计算伤害减免**
4.  **计算增益加成**
5.  **判定暴击与格挡**
6.  **计算伤害稳定**
7.  **最终裁定 (应用下限)**

### **第四部分：技术架构与开发规范**

#### **4.1 项目文件结构**

项目采用高度模块化的结构，确保不同功能和数据的分离。

```markdown
/
├── index.html            (主页面骨架)
|
├── config/               (所有游戏数据配置)
│   ├── classes.js        (职业数据)
│   ├── monsters.js       (怪物数据)
│   ├── items.js          (道具装备数据)
│   ├── zones.js          (探索区域数据)
│   ├── translations.js   (中文翻译)
│   └── index.js          (配置模块出口)
|
└── js/                   (所有程序逻辑)
    ├── main.js           (程序主入口和事件中心)
    ├── ui.js             (所有UI更新和交互)
    ├── auth.js           (用户认证逻辑)
    ├── state.js          (全局状态管理器)
    ├── game.js           (高级游戏流程，如探索)
    ├── combat.js         (战斗流程控制)
    ├── attributes.js     (二级属性计算器)
    ├── combatFormulas.js (三级属性和伤害计算)
    ├── testTool.js       (数值测试工具逻辑)
    ├── firebase.js       (Firebase初始化)
    └── utils.js          (通用工具函数)


```

#### **4.2 核心设计原则**

*   **数据与逻辑分离**: 这是本项目的最高原则。所有可调整的游戏数据（职业属性、怪物掉落等）都必须存放在 `/config` 文件夹中，而 `/js` 文件夹只负责实现游戏规则和逻辑。
*   **模块化**: 每个 `.js` 文件都应只负责一项明确的功能（例如，`auth.js` 只管登录注册，`combat.js` 只管战斗流程）。
*   **单一状态源**: `state.js` 文件是游戏客户端的唯一状态来源，任何模块都不应私自存储状态，以杜绝数据不同步的问题。
*   **事件委托**: `main.js` 采用在顶层容器 `#app` 上进行事件委托的模式，来统一、高效、健壮地处理所有用户点击事件。

#### **4.3 未来展望：可视化编辑器**

当前的技术架构完全是为了支撑未来的**可视化编辑器**而设计的。编辑器的核心功能将是读取 `/config` 文件夹下的数据文件，将其以图形化界面的形式呈现给策划人员，并在策划人员修改后，将结果写回这些文件。这种工作流将极大地提升数值调整和内容更新的效率。
